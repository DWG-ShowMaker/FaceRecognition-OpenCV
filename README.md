# 人脸识别系统

这是一个使用OpenCV和Python实现的人脸识别系统，支持人脸录入和验证功能，具有现代化的图形界面。

## 功能特性

- 实时摄像头人脸检测
- 人脸特征录入和验证
- 完整的用户管理系统：
  - 添加新用户
  - 删除现有用户
  - 修改用户信息
  - 重新采集人脸数据
- 用户验证历史记录
- 实时状态显示和视觉反馈：
  - 绿色状态块：验证通过
  - 红色状态块：验证失败
  - 蓝色状态块：录入/采集中
- 响应式图形用户界面(GUI)
- 用户搜索功能

## 技术栈

- Python 3.x
- OpenCV-Python (图像处理和人脸识别)
- tkinter (GUI界面)
- PIL/Pillow (图像处理)
- Threading (多线程处理)
- LBPH人脸识别算法

## 安装依赖

1. 安装所需的 Python 包：
   
   ```bash
   pip install opencv-contrib-python
   pip install pillow
   ```

注意：必须使用 opencv-contrib-python 而不是普通的 opencv-python，因为人脸识别功能需要 contrib 模块。

## 启动方法

1. 确保已安装所有依赖包
2. 在命令行中进入程序所在目录
3. 运行以下命令启动程序：

   ```bash
   python face_detector.py
   ```

## 使用说明

1. 程序启动后会显示GUI界面，包含：
   - 左侧：摄像头视频显示区域（自适应大小）
   - 右侧：控制面板
     - 用户信息输入
     - 功能按钮
     - 状态显示
     - 用户管理区域

2. 人脸录入：
   - 输入用户名
   - 点击"录入人脸"按钮
   - 保持面部在摄像头前，系统会自动采集20张人脸样本
   - 右上角蓝色状态块显示采集进度
   - 采集完成后自动保存

3. 人脸验证：
   - 点击"开始验证"按钮
   - 将面部对准摄像头
   - 系统会实时显示验证结果
   - 右上角状态块显示验证结果（绿色为通过，红色为失败）

4. 用户管理：
   - 支持用户搜索（实时过滤）
   - 选择用户后可以：
     - 删除用户
     - 修改用户名
     - 重新采集人脸
   - 显示用户详细信息：
     - 用户ID
     - 注册时间
     - 最后验证时间
     - 最后更新时间

5. 其他操作：
   - 点击"停止"按钮可以停止当前操作
   - 窗口大小可调整，界面会自适应

## 注意事项

1. 确保电脑有可用的摄像头
2. 录入人脸时保持适当的光线条件
3. 录入时尽量展示不同角度的面部表情
4. 验证时保持自然表情
5. 首次使用时需要先录入人脸
6. 程序会自动保存用户数据和训练模型

## 数据存储

- 用户数据存储在 `face_data` 目录下
- 人脸识别模型保存为 `face_model.yml`
- 用户信息保存在 `face_data/users.pkl` 文件中

## 打包说明

### 环境要求

- macOS 操作系统
- Python 3.x
- Homebrew (用于安装create-dmg)

### 打包步骤

1. 安装必要的依赖：
   ```bash
   pip install -r requirements.txt
   ```

2. 给打包脚本添加执行权限：
   ```bash
   chmod +x build_app.sh
   chmod +x create_dmg.sh
   ```

3. 运行打包脚本生成应用程序：
   ```bash
   ./build_app.sh
   ```
   打包完成后，应用程序将位于 `dist/FaceRecognition.app`

4. (可选) 创建DMG安装包：
   ```bash
   ./create_dmg.sh
   ```
   这将生成一个名为 `FaceRecognition.dmg` 的安装包

### 打包文件说明

- `setup.py`: py2app打包配置文件
- `build_app.sh`: 应用程序打包脚本
- `create_dmg.sh`: DMG安装包创建脚本
- `requirements.txt`: 项目依赖列表

### 注意事项

1. 确保所有依赖都已正确安装
2. 打包前请先测试程序能正常运行
3. 如果需要自定义应用图标，请准备 `.icns` 格式的图标文件
4. 打包过程中可能需要较长时间，请耐心等待
5. 首次运行打包后的应用程序时，需要在系统偏好设置中允许摄像头访问权限